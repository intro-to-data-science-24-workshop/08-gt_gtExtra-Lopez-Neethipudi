---
title: "Creating presentation - ready tables with gt and gtExtras"
author: "Elena Mijares Lopez and Ujwal Neethipudi"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float: true
    theme: cosmo
---

## Introduction

In this workshop, we will explore how to create tables using the gt and gtExtras packages, utilizing the pizza place dataset. We will start with a basic table using base R to display pizza information, then enhance our visualization using the gt package to create a more polished and user-friendly table. Finally, we will upgrade our visualization further with the gtExtras package, adding even more features and styles to improve the overall presentation of our pizza menu.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(dplyr)
library(gt)
library(gtExtras)
library(svglite)
```

## The Data

Let's look at our pizza sales dataset:

```{r}
# Load and assign the pizza dataset to an object
data("pizzaplace")
pizza_data <- pizzaplace
head(pizza_data)
```

## Basic Table (Before gt)

First, let's create a summary table using basic R:

```{r}
pizza_summary <- pizza_data %>%
  group_by(type, size) %>%
  summarize(
    total_sales = sum(price),
    num_orders = n(),
    avg_price = mean(price),
    .groups = 'drop'
  )

# Display as basic table
print(pizza_summary)
```

## Basic gt Features

### Step 1: Basic gt Table

Let's start with a simple gt table:

```{r}
pizza_summary %>%
  gt(
    groupname_col = "type"
  )
```

### Step 2: Adding Formatting

Now let's add currency and number formatting:

```{r}
pizza_summary %>%
  gt(
    groupname_col = "type"
  ) %>%
  fmt_currency(
    columns = c(total_sales, avg_price),
    currency = "USD"
  ) %>%
  fmt_number(
    columns = num_orders,
    decimals = 0
  )
```

### Step 3: Adding Headers and Labels

Let's improve the presentation with better headers:

```{r}
pizza_summary %>%
  gt(
    groupname_col = "type"
  ) %>%
  fmt_currency(
    columns = c(total_sales, avg_price),
    currency = "USD"
  ) %>%
  fmt_number(
    columns = num_orders,
    decimals = 0
  ) %>%
  tab_header(
    title = "Pizza Sales Analysis",
    subtitle = "Sales breakdown by type and size"
  ) %>%
  cols_label(
    total_sales = "Total Sales",
    num_orders = "Number of Orders",
    avg_price = "Average Price",
    size = "Pizza Size"
  )
```

### Step 4: Adding Visual Elements with gtExtras

Now let's add some visual enhancements:

```{r}
pizza_summary %>%
  gt(
    groupname_col = "type"
  ) %>%
  fmt_currency(
    columns = c(total_sales, avg_price),
    currency = "USD"
  ) %>%
  fmt_number(
    columns = num_orders,
    decimals = 0
  ) %>%
  tab_header(
    title = "Pizza Sales Analysis",
    subtitle = "Sales breakdown by type and size"
  ) %>%
  cols_label(
    total_sales = "Total Sales",
    num_orders = "Number of Orders",
    avg_price = "Average Price",
    size = "Pizza Size"
  ) %>%
  gt_theme_538() %>%
  data_color(
    columns = c(total_sales),
    colors = scales::col_numeric(
      palette = c("white", "#1F77B4"),
      domain = NULL
    )
  )
```

## Advanced Features

### Sales Trends Visualization

Let's create a different view focusing on pizza types:

```{r}
pizza_data %>%
  group_by(type) %>%
  summarize(
    total_sales = sum(price),
    num_orders = n(),
    avg_price = mean(price),
    pct_total = num_orders/nrow(pizza_data)
  ) %>%
  ungroup() %>%
  gt() %>%
  fmt_currency(
    columns = c(total_sales, avg_price),
    currency = "USD"
  ) %>%
  fmt_number(
    columns = num_orders,
    decimals = 0
  ) %>%
  fmt_percent(
    columns = pct_total,
    decimals = 1
  ) %>%
  data_color(
    columns = pct_total,
    colors = scales::col_numeric(
      palette = c("white", "steelblue"),
      domain = NULL
    )
  ) %>%
  cols_label(
    type = "Pizza Type",
    total_sales = "Total Sales",
    num_orders = "Number of Orders",
    avg_price = "Average Price",
    pct_total = "% of Total Orders"
  ) %>%
  tab_header(
    title = "Pizza Type Analysis",
    subtitle = "Sales and order distribution by pizza type"
  )
```

### Dark Theme Example

```{r}
pizza_data %>%
  group_by(type) %>%
  summarize(
    total_sales = sum(price),
    num_orders = n(),
    avg_price = mean(price)
  ) %>%
  gt() %>%
  fmt_currency(
    columns = c(total_sales, avg_price),
    currency = "USD"
  ) %>%
  fmt_number(
    columns = num_orders,
    decimals = 0
  ) %>%
  gt_theme_dark() %>%
  tab_header(
    title = "Pizza Sales in Dark Theme",
    subtitle = "A different perspective on our data"
  )
```

### Summary Rows Feature

```{r}
pizza_data %>%
  group_by(type) %>%
  summarize(
    total_sales = sum(price),
    num_orders = n(),
    avg_price = mean(price)
  ) %>%
  ungroup() %>%
  gt(
    groupname_col = "type"
  ) %>%
  fmt_currency(
    columns = c(total_sales, avg_price),
    currency = "USD"
  ) %>%
  fmt_number(
    columns = num_orders,
    decimals = 0
  ) %>%
  grand_summary_rows(
    columns = total_sales,
    fns = list(
      "Total" = ~sum(.)
    ),
    fmt = ~ fmt_currency(., currency = "USD")  
  ) %>%
  grand_summary_rows(
    columns = num_orders,
    fns = list(
      "Total" = ~sum(.)
    ),
    fmt = ~ fmt_number(., decimals = 0)  
  )

```

